
# h函数作用

h函数作用: 创建一个用于描述真实DOM结构的JavaScript对象.
举例:
  描述一个dom元素
  ```html
    <a href='www.baidu.com'>百度</a>
  ```
  使用
  ```js
    h('a', {props: { href: 'www.baidu.com'}}, '百度')
  ```
  h函数会返回一个JavaScript对象.就是虚拟DOM,经过简化之后的内容如下:
  ```js
    {
      "sel": "a",
      "data": {
        "href": "www.baidu.com"
      },
      "text": "百度"
    }
  ```
h函数的结构十分灵活,可以通过h函数嵌套来表达dom层级.

# h函数的设计思想

在snabbom中,有一个vnode方法专门封装h函数返回的虚拟dom节点.
h函数的参数有以下三种情况:
```js
  h('标签', { 数据对象 }, '文字');	//最后一个参数是文字
  h('标签', { 数据对象 }, []);	//最后一个参数是数组
  h('标签', { 数据对象 }, h());	//最后一个参数是嵌套的h函数
```
1.对于第一种情况,可以直接输出`vNode对象`.
2.第二种情况,我们需要`遍历`数组中的每一个元素,如果是`h函数`对象的数组集合.将其push到vnode的children属性中.
  ① h函数对象的判断:
  检查是否包含`sel`属性即可,这是`h函数`的标识
  ```js
    typeof c[i] == 'object' && c[i].hasOwnProperty('sel')
  ```
  ② 循环遍历数组的时候,其实也是正在执行h函数,将返回值push到vnode的children中即可
  ```js
    children.push(c[i])
  ```
3.如果是第三种情况,代表传入的第三个参数 `h()` 是唯一的参数, 将其返回到vnode的children中即可.

** 按照这种方式递归取值,最终取到DOM的描述对象

** 这个和编辑器预想的效果是一样的,以json的形式存内容,以h函数进行解析

# vs Vue-h函数

vue中的h函数应该多了一些component的校验,同时也会触发`get`,`set`方法

# 源码简析

```jsx
  // h 函数的重载
  export function h(sel: string): VNode;
  export function h(sel: string, data: VNodeData): VNode;
  export function h(sel: string, children: VNodeChildren): VNode;
  export function h(sel: string, data: VNodeData, children: VNodeChildren): VNode;
  export function h(sel: any, b?: any, c?: any): VNode {
    var data: VNodeData = {}, children: any, text: any, i: number;
    // 处理参数，实现重载的机制.
    // 处理三个参数的情况:sel、data、children/text
    if (c !== undefined) {
      data = b;
      // 如果 b 是数组
      if (is.array(c)) { children = c; }
      // 如果 c 是字符串或者数字
      else if (is.primitive(c)) { text = c; }
      // 如果 c 是 VNode
      else if (c && c.sel) { children = [c]; }
    } else if (b !== undefined) {
      // 处理两个参数的情况
      if (is.array(b)) { children = b; }
      else if (is.primitive(b)) { text = b; }
      else if (b && b.sel) { children = [b]; }
      else { data = b; }
    }
    if (children !== undefined) {
      // 处理 children 中的原始值(string/number)
      for (i = 0; i < children.length; ++i) {
        // 如果 child 是 string/number，创建文本节点
        if (is.primitive(children[i])) children[i] = vnode(undefined, undefined, undefined, children[i], undefined);
      }
    }
    if (
      sel[0] === 's' && sel[1] === 'v' && sel[2] === 'g' &&
      (sel.length === 3 || sel[3] === '.' || sel[3] === '#')
    ) {
      // 如果是 svg，添加命名空间
      addNS(data, children, sel);
    }
    // 返回 VNode
    return vnode(sel, data, children, text, undefined);
  };
  // 导出模块
  export default h;
```
