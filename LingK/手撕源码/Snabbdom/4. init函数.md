
# 参数

init(modules, domApi)

# 功能

1.收集所有模块中的`钩子函数`,储存在`cb对象`中
2.返回`patch函数`(类似HOC的高阶函数)

# 为什么要使用patch高阶函数?

1.patch函数在外部会多次调用,每次调用都会依赖一些参数,例如:`modules/domApi/cbs`
2.通过HOC,让init内部形成闭包,返回的`patch函数`可以访问到依赖参数

# 源码简析

```jsx
  const hooks: (keyof Module)[] = ['create', 'update', 'remove','destroy', 'pre', 'post'];
  export function init(modules: Array<Partial<Module>>, domApi?: DOMAPI)
  {
  let i: number, j: number, cbs = ({} as ModuleHooks);
  // 初始化 api
  const api: DOMAPI = domApi !== undefined ? domApi : htmlDomApi;
  // 把传入的所有模块的钩子方法，统一存储到 cbs 对象中
  // 最终构建的 cbs 对象的形式 cbs = [ create: [fn1, fn2], update: [], ...]
  for (i = 0; i < hooks.length; ++i) {
    // cbs['create'] = []
    cbs[hooks[i]] = [];
    for (j = 0; j < modules.length; ++j) {
      // const hook = modules[0]['create']
      const hook = modules[j][hooks[i]];
      if (hook !== undefined) {
        (cbs[hooks[i]] as Array<any>).push(hook);
      }
  } }
    ......
    ......
    ......
    return function patch(oldVnode: VNode | Element, vnode: VNode): VNode
  {}
  }
```
