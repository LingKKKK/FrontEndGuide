

# 参数

createElm(vnode, insertedVnodeQueue)

# 作用

通过`VNode`节点信息,解析并返回对应的`DOM`元素

# 执行的过程

1.触发用户设置的`init函数`
2.如果选择器是`!`,创建`注释节点`
3.如果选择器为`空`,创建`文本节点`
4.如果选择器不为空
  选择解释器, 设置标签的`id`和`class`属性
  执行模块的`create`钩子函数
  如果`vNode`有`children`,创建`子vNode`对应的`DOM`并追加到`DOM树`上
  如果`VNode`的`text`值是`string/number`,创建`文本节点`,并追加到`DOM树`上
5.返回`VNodeEle`

```jsx src/snabbdom.ts
  function createElm(vnode: VNode, insertedVnodeQueue: VNodeQueue): Node {
    let i: any, data = vnode.data;
    if (data !== undefined) {
      // 执行用户设置的 init 钩子函数
      if (isDef(i = data.hook) && isDef(i = i.init)) {
        i(vnode);
        data = vnode.data;
      }
    }
    let children = vnode.children, sel = vnode.sel;
    if (sel === '!') {
      // 如果选择器是!，创建注释节点
      if (isUndef(vnode.text)) {
        vnode.text = '';
      }
      // 如果选择器不为空
      // 解析选择器
      // Parse selector
      vnode.elm = api.createComment(vnode.text as string);
    } else if (sel !== undefined) {
      const hashIdx = sel.indexOf('#');
      const dotIdx = sel.indexOf('.', hashIdx);
      const hash = hashIdx > 0 ? hashIdx : sel.length;
      const dot = dotIdx > 0 ? dotIdx : sel.length;
      const tag = hashIdx !== -1 || dotIdx !== -1 ? sel.slice(0, Math.min(hash, dot)) : sel;
      const elm = vnode.elm = isDef(data) && isDef(i = (data as VNodeData).ns) ? api.createElementNS(i, tag) : api.createElement(tag);
      if (hash < dot) elm.setAttribute('id', sel.slice(hash + 1, dot));
      if (dotIdx > 0) elm.setAttribute('class', sel.slice(dot + 1).replace(/\./g, ' '));
      // 执行模块的 create 钩子函数
      for (i = 0; i < cbs.create.length; ++i) cbs.create[i](emptyNode, vnode);
      // 如果 vnode 中有子节点，创建子 vnode 对应的 DOM 元素并追加到 DOM 树上
      if (is.array(children)) {
        for (i = 0; i < children.length; ++i) {
          const ch = children[i];
          if (ch != null) {
            api.appendChild(elm, createElm(ch as VNode, insertedVnodeQueue));
          }
        }
      } else if (is.primitive(vnode.text)) {
        // 如果 vnode 的 text 值是 string/number，创建文本节点并追加到 DOM 树
        api.appendChild(elm, api.createTextNode(vnode.text));
      }
      i = (vnode.data as VNodeData).hook; // Reuse variable
      if (isDef(i)) {
        // 执行用户传入的钩子 create
        if (i.create) i.create(emptyNode, vnode);
        // 把 vnode 添加到队列中，为后续执行 insert 钩子做准备
        if (i.insert) insertedVnodeQueue.push(vnode);
      }
    } else {
      // 如果选择器为空，创建文本节点
      vnode.elm = api.createTextNode(vnode.text as string);
    }
    // 返回新创建的 DOM
    return vnode.elm;
  }
```
