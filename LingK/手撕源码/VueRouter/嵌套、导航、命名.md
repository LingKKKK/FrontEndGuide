# 嵌套路由

有一些应用程序的`UI`由`多层嵌套组件`组成. URL 的`片段`通常对应`特定的嵌套组件结构`.

```嵌套组件层级
/user/johnny/profile                  /user/johnny/posts
+------------------+                  +-----------------+
| User             |                  | User            |
| +--------------+ |                  | +-------------+ |
| | Profile      | |  +------------>  | | Posts       | |
| |              | |                  | |             | |
| +--------------+ |                  | +-------------+ |
+------------------+                  +-----------------+
```

```js
<div id="app">
  <router-view></router-view>
</div>;

const User = {
  template: "<div>User {{ $route.params.id }}</div>",
};
// 这些都会传递给 `createRouter`
const routes = [{ path: "/user/:id", component: User }];
```

这里的`<router-view>`是一个顶层的`router-view`,它渲染顶层的路由匹配组件.
我们要渲染子组件,需要在`User`组件中,添加一个`<router-view>`结构

```js
const User = {
  template: `
    <div class="user">
      <h2>User {{ $route.params.id }}</h2>
      <router-view></router-view>
    </div>
  `,
};
```

要将子组件渲染到子`<router-view>`中,需要给`router`添加`children`属性.

```js
const routes = [
  {
    path: "/user/:id",
    component: User,
    children: [
      {
        // 当 /user/:id/profile 匹配成功
        // UserProfile 将被渲染到 User 的 <router-view> 内部
        path: "profile",
        component: UserProfile,
      },
      {
        // 当 /user/:id/posts 匹配成功
        // UserPosts 将被渲染到 User 的 <router-view> 内部
        path: "posts",
        component: UserPosts,
      },
    ],
  },
];
```

**注意, 以/开头的嵌套路径被视为根路径. 这就允许我们利用组件嵌套渲染,而不一定非要使用 URL**
解释: 意思就是,渲染深层组件的时候,会附带的渲染 layout 模板,不比严格的定义一层层的路由结构.

## 嵌套路由的命名

在处理`命名`时,通常会给子路由命名,这样能确保父级一定能显示.

```js
const routes = [
  {
    path: "/user/:id",
    component: User,
    // 请注意，只有子路由具有名称
    children: [{ path: "", name: "user", component: UserHome }],
  },
];
```

_解释: 渲染 name='user'的路由时, User 组件和 UserHome 组件都会被加载_
**可以理解成向上的兼容性**

# 编程式导航

1. 借助 router 的实例方法,通过编写代码来实现.
2. 这些 api 都会返回`Promise`对象.可以由此检测他们是否成功的执行了.
3. 这些 api 和 window.history 的 api 一样,可以类比.

## 导航到不同的位置

*this.$route*可以访问到当前的路由实例,由此,可以利用*实例上的 api*

```js
// 字符串路径
router.push("/users/eduardo");
// 带有路径的对象
router.push({ path: "/users/eduardo" });
// 命名的路由，并加上参数，让路由建立 url
router.push({ name: "user", params: { username: "eduardo" } });
// 带查询参数，结果是 /register?plan=private
router.push({ path: "/register", query: { plan: "private" } });
// 带 hash，结果是 /about#team
router.push({ path: "/about", hash: "#team" });
```

**注意**
如果提供了`path`, `params`就会被忽略.
需要提供路由的`name`或者手写的完整的带有参数的`path`

```js
const username = "eduardo";
// 我们可以手动建立 url，但我们必须自己处理编码
router.push(`/user/${username}`); // -> /user/eduardo
// 同样
router.push({ path: `/user/${username}` }); // -> /user/eduardo
// 如果可能的话，使用 `name` 和 `params` 从自动 URL 编码中获益
router.push({ name: "user", params: { username } }); // -> /user/eduardo
// `params` 不能与 `path` 一起使用
router.push({ path: "/user", params: { username } }); // -> /user
```

**注意**
当指定了`params`时,可提供`string`或者`number`参数.其他的类型,都会自动被字符串化.

## 替换当前的位置

给*routeLocation*中添加`replace`属性. 替换当前的栈.

```js
router.push({ path: "/home", replace: true });
// 相当于
router.replace({ path: "/home" });
```

## 横跨历史记录

因为路由是基于 history 栈来实现的. 可以直接访问栈中的索引. `window.history.go(n)`

```js
// 向前移动一条记录，与 router.forward() 相同
router.go(1);
// 返回一条记录，与 router.back() 相同
router.go(-1);
// 前进 3 条记录
router.go(3);
// 如果没有那么多记录，静默失败
router.go(-100);
router.go(100);
```

# 命名路由

除了`path`之外,可以给任何路由进行命名`name`.
1. 没有了硬编码的URL
2. params的自动编码/解码
3. 防止在输入url时发生错误(name较为简洁)
4. 绕过路径的排序(仅显示一个,url会匹配多个)

# 命名视图

有时候页面中需要同时展示多个视图(同级),而不是嵌套展示.
```html
<router-view class="view left-sidebar" name="LeftSidebar"></router-view>
<router-view class="view main-content"></router-view>
<router-view class="view right-sidebar" name="RightSidebar"></router-view>
```
在`路由表`中,添加对应的`组件name`,并且将`component`改为`components`
```js
const router = createRouter({
  history: createWebHashHistory(),
  routes: [
    {
      path: '/',
      components: {
        default: Home, // default属性表示默认加载项
        // LeftSidebar: LeftSidebar 的缩写
        LeftSidebar,
        // 它们与 `<router-view>` 上的 `name` 属性匹配
        RightSidebar,
      },
    },
  ],
})
```

```
/settings/emails                                       /settings/profile
+-----------------------------------+                  +------------------------------+
| UserSettings                      |                  | UserSettings                 |
| +-----+-------------------------+ |                  | +-----+--------------------+ |
| | Nav | UserEmailsSubscriptions | |  +------------>  | | Nav | UserProfile        | |
| |     +-------------------------+ |                  | |     +--------------------+ |
| |     |                         | |                  | |     | UserProfilePreview | |
| +-----+-------------------------+ |                  | +-----+--------------------+ |
+-----------------------------------+                  +------------------------------+
```
