## æ•°æ®é©±åŠ¨

Vue.jsçš„ä¸€ä¸ªæ ¸å¿ƒçš„æ€æƒ³å°±æ˜¯`æ•°æ®é©±åŠ¨`.
æ‰€è°“`æ•°æ®é©±åŠ¨`, æ˜¯æŒ‡`è§†å›¾`ç”±`æ•°æ®é©±åŠ¨`ç”Ÿæˆ; å¹¶éç›´æ¥æ“çºµDOMå…ƒç´ ,è€Œæ˜¯é€šè¿‡ä¿®æ”¹æ•°æ®;

å’ŒJqueryç­‰ç›´æ¥ä¿®æ”¹domå…ƒç´ çš„åº“ç›¸æ¯”, Vueå¤§å¤§çš„ç®€åŒ–äº†ä»£ç , ç‰¹åˆ«æ˜¯å½“äº¤äº’å¤æ‚æ—¶, å®Œå…¨å§”æ‰˜æ•°æ®å»ç®¡ç†;
MVVM, å°†é€»è¾‘éƒ½åœ¨VMä¸­è¿›è¡Œå¤„ç†, æ›´æ¸…æ™°æ˜“äºç»´æŠ¤; (jqueryä¸­çš„é€»è¾‘å’Œdomå…ƒç´ æ˜¯å¯†ä¸å¯åˆ†çš„)

å¯ä»¥æŠŠæ•°æ®å’Œdomçœ‹åšä¸€ç§æ˜ å°„å…³ç³»; æˆ‘ä»¬ä¸èƒ½ç›´æ¥æ“ä½œdom, åªèƒ½é€šè¿‡ä»–çš„é”®(æ•°æ®)è¿›è¡Œä¿®æ”¹

## MVVMã€MVCã€MVP æ¨ªå‘å¯¹æ¯”

å¾ˆå¤šæ—¶å€™, æˆ‘ä»¬è§‰å¾—å¯ä»¥å®ç°åŒå‘ç»‘å®š, æ•°æ®é©±åŠ¨, ä½†æ˜¯è¿™å’ŒVueé‡Œé¢çš„æœ‰å¾ˆå¤§çš„åŒºåˆ«;
Vueä¸­çš„VMå¹¶éæ˜¯ä¸€ä¸ªç®€å•çš„é©±åŠ¨ã€ç›‘å¬å…³ç³»; (Observer/Depç­‰)

[å‚è€ƒ1](https://www.baidu.com/s?ie=UTF-8&wd=mvvm%20mvc%20mvp)
[å‚è€ƒ2](http://www.ruanyifeng.com/blog/2015/02/mvcmvp_mvvm.html)

#### MVC
ä¾‹å¦‚: Jquery

Mvcçš„æ„æ€æ˜¯, æˆ‘ä»¬çš„å·¥ç¨‹å¯ä»¥åˆ†åŸä¸‰ä¸ªéƒ¨åˆ†:
- æ¨¡å‹(Model): æ•°æ®ä¿å­˜
- è§†å›¾(View): ç”¨æˆ·ç•Œé¢
- æ§åˆ¶å™¨(Control): ä¸šåŠ¡é€»è¾‘ã€æ§åˆ¶å™¨

å„éƒ¨åˆ†ä¹‹é—´çš„é€šä¿¡éƒ½æ˜¯å•å‘çš„:
- View ä¼ é€æŒ‡ä»¤åˆ° Controller
- Controller å®Œæˆä¸šåŠ¡é€»è¾‘åï¼Œè¦æ±‚ Model æ”¹å˜çŠ¶æ€
- Model å°†æ–°çš„æ•°æ®å‘é€åˆ° Viewï¼Œç”¨æˆ·å¾—åˆ°åé¦ˆ
- é—­ç¯çš„æ•°æ®æµ: ç”¨æˆ·æ“ä½œé¡µé¢ â–¶ï¸ é€šè¿‡é€»è¾‘å¤„ç† â–¶ï¸ æ•°æ®çŠ¶æ€å‘ç”Ÿæ”¹å˜ â–¶ï¸ åé¦ˆåˆ°é¡µé¢,å‘ŠçŸ¥ç”¨æˆ·

#### MVP
ä¾‹å¦‚: React

MVPåœ¨MVCçš„åŸºç¡€ä¸Š, å°†Controlæ”¹ä¸ºPresenter; åŒæ—¶æ”¹å˜çš„é€šä¿¡æ–¹å‘;
- å„éƒ¨åˆ†ä¹‹é—´çš„é€šä¿¡éƒ½æ˜¯åŒå‘çš„
- Viewå’ŒModelä¸ç›´æ¥é€šä¿¡, ç»è¿‡Presenteré€šä¿¡
- View(è¢«åŠ¨è§†å›¾)æ²¡æœ‰ä»»ä½•ä¸šåŠ¡é€»è¾‘,æ²¡æœ‰ä»»ä½•ä¸»åŠ¨æ€§;
- PresenteråŒ…å«äº†æ‰€æœ‰çš„é€»è¾‘
- æ•°æ®æµ: è§†å›¾ â†”ï¸ é€»è¾‘ â†”ï¸ æ•°æ®æ¨¡å—

#### MVVM
ä¾‹å¦‚: Vueã€Angularã€Ember
MVVM: å°†Presenteræ”¹åä¸º ViewModel, åŸºæœ¬ä¸Šå’ŒMVPæ¨¡å¼ä¸€è‡´;
- åŒå‘ç»‘å®š(data-binding): viewå˜åŠ¨æ—¶, ä¸»åŠ¨ååº”åœ¨ViewModelä¸­;

## æ€è€ƒ: åŒå‘ç»‘å®šçš„åŸç†å°±æ˜¯ä¸»åŠ¨è§¦å‘, reactèƒ½ä½¿ç”¨åŒå‘ç»‘å®šä¹ˆ?
- mvvmå’Œmvpçš„æœ¬è´¨å·®åˆ«å°±æ˜¯åŒå‘ç»‘å®š, åŒå‘ç»‘å®šçš„ä¼˜åŠ¿åœ¨å“ªå„¿å‘¢?
- åŒå‘ç»‘å®šçš„åŸç†å°±æ˜¯ä¸»åŠ¨è§¦å‘, å¯ä»¥æ‰‹åŠ¨å®ç°ä¹ˆ?
- ä¸ºä»€ä¹ˆreactä¸é€‚ç”¨åŒå‘ç»‘å®š?

#### ä¸ºä»€ä¹ˆReactæ²¡æœ‰åŒå‘ç»‘å®š
- reactçš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯: å•å‘æ•°æ®æµ; åœ¨çº¯ç²¹çš„reactä¸­, ä¸éœ€è¦åŒå‘ç»‘å®šçš„åŠŸèƒ½;
- å•å‘æ•°æ®æµ(props, state)å·²ç»æ»¡è¶³äº†viewå±‚çš„æ¸²æŸ“è¦æ±‚,æ›´æ˜“æµ‹è¯•å’Œæ§åˆ¶.
- å•å‘æ•°æ®æµ: åªèƒ½ç”±çˆ¶ç»„ä»¶é€šè¿‡propså°†æ•°æ®ä¼ å‘å­ç»„ä»¶,ä¸èƒ½ç”±å­ç»„ä»¶å‘çˆ¶ç»„ä»¶ä¼ æ•°æ®;

å¦‚æœè¦å®ç°åŒå‘ç»‘å®š
1. å¯ä»¥å€ŸåŠ©ç¬¬ä¸‰æ–¹åº“, ä¹Ÿå¯ä»¥åœ¨state/reduxä¸­è§£å†³.
2. åªèƒ½ç”±å­ç»„ä»¶æ¥æ”¶çˆ¶ç»„ä»¶propsä¼ è¿‡æ¥çš„æ–¹æ³•å»æ”¹å˜çˆ¶ç»„ä»¶æ•°æ®,è€Œä¸æ˜¯ç›´æ¥å°†å­ç»„ä»¶æ•°æ®å‘ä¸Šä¼ é€’
   ç±»ä¼¼$emitè§¦å‘ä¸€äº›æ–¹æ³•
3. å°±ç®—å®ç°äº†æ•°æ®ç»‘å®š,ä¹Ÿå¹¶éMVVMä¸­çš„åŒå‘ç»‘å®š,æ²¡æœ‰ä»æ ¹æœ¬ä¸Šå®ç°,ä»…ä»…å®ç°äº†ä»–çš„åŠŸèƒ½;

#### Reactä¼˜åŠ¿æ˜¯å•é¡¹æ•°æ®æµ, Vueçš„ä¼˜åŠ¿æ˜¯åŒå‘ç»‘å®š, ä¸¤ç§ä¸åŒçš„æœºåˆ¶å¦‚ä½•è‡ªåœ†å…¶è¯´? åœ¨åŒä¸€ä¸ªæ—¶ä»£é‡Œå¦‚ä½•å»ºç«‹ç»Ÿä¸€çš„ç†è§£? è¿˜æ˜¯è¯´è¿™ä¸¤ç§æœºåˆ¶æœ‰ä¸åŒçš„æœ€ä½³åº”ç”¨åœºæ™¯?
[å‚è€ƒ](https://www.zhihu.com/question/49964363)
##### æœ‰ä½•ä¸åŒ?
åªæœ‰UIæ§ä»¶æ‰å­˜åœ¨åŒå‘ç»‘å®š, éUIæ§ä»¶åªæœ‰å•å‘; åœ¨ç»™è‡ªå®šä¹‰ç»„ä»¶ä¼ é€’æ•°æ®æ—¶, ä¹Ÿå­˜åœ¨åŒå‘ç»‘å®š;
- v-model / åˆ†åˆ«å¯¹åº”Vueä¸­çš„è‡ªå®šä¹‰ç»„ä»¶çš„å®ç°
- è‡ªå®šä¹‰çš„åŒå‘ç»‘å®š, å…¶å®å°±æ˜¯compilerè¿‡ç¨‹è¯†åˆ«å¯¹åº”çš„è¯­æ³•, ç„¶åç»™watcheræ·»åŠ ä¸€ä¸ªsync flagå’Œçˆ¶ç´¢å¼•, ä¸‹æ¬¡æ›´æ–°æ—¶åŒæ­¥
- v-modelæ˜¯ä¸€ä¸ªè¯­æ³•ç³–(one-way binding + auto event binding)

`å¼„æ¸…æ¥šäº†åŒå‘ç»‘å®šçš„åŸç†, ç„¶åå¯¹æ¯”ä¸€ä¸‹åŒå‘å’Œå•å‘çš„åŒºåˆ«: åŒå‘ç»‘å®šæŠŠ"ç›‘å¬/åŒæ­¥"æ“ä½œéšåŒ¿åœ¨æ¡†æ¶å†…éƒ¨, è°ƒç”¨è€…æ— æ„ŸçŸ¥;`
å•å‘å’ŒåŒå‘çš„åŒºåˆ«æ˜¯æ¡†æ¶åˆ†è£…çš„ä¸åŒ, æœ¬è´¨ä¸Šéƒ½å¯ä»¥äº’ç›¸å®ç°çš„;

##### å¦‚ä½•åŒå‘å®ç°?
åœ¨reactæ¡†æ¶ä¸­, å•å‘ç»‘å®š â¡ï¸ å•å‘æ•°æ®æµ; åœ¨fluxæ•°æ®æµä½“ç³»çš„å®ç°ä¸­, ä¾æ‰˜äºå•ä¾‹å®ç°çš„`å…¨å±€äº‹ä»¶åˆ†å‘å™¨`(dispatcher). å¼€å‘è€…å¿…é¡»ç»Ÿä¸€çš„,æ˜¾å¼çš„è°ƒç”¨è¿™ä¸ª"äº‹ä»¶æœºåˆ¶"æ¥è¿›è¡Œæ•°æ®çš„å˜æ›´; è¿™å…¶å®å’ŒVueçš„åº•å±‚åŒå‘ç»‘å®šä¸€æ ·, éƒ½æ˜¯åœ¨`æ‰§è¡Œåº•å±‚çš„äº‹ä»¶æœºåˆ¶`;

`åŒå‘ç»‘å®šå¦‚ä½•å®ç°dispatcherè¿™ç§å…¨å±€ç®¡ç†æœºåˆ¶`
- åŠ«æŒåˆ°æ¡†æ¶å¯¹UIç»„ä»¶è‡ªåŠ¨ç»‘å®šçš„äº‹ä»¶çš„`listener`æˆ–è€…æ•°æ®çš„`watcher`
- æ·»åŠ ç±»ä¼¼dispatcherçš„é€»è¾‘
- é€šè¿‡dispatcherå¯¹åŒå‘ç»‘å®šè¿›è¡Œ`ç®¡ç†`

`å•å‘æ•°æ®æµå¦‚ä½•å®ç°åŒå‘ç»‘å®š`
- å®˜ç½‘çš„LinkedStateMixin
- è‡ªå®šä¹‰çš„ç»‘å®šç›‘å¬äº‹ä»¶

```shell
  # React/Fluxå®ç°åŒå‘ç»‘å®šçš„è¿‡ç¨‹
  Fluxçš„æµç¨‹ç¤ºæ„:
     --------------  é©±åŠ¨/è§¦å‘  --------------
    â†“                                        â†‘
  Action   â–¶ï¸   Dispatcher   â–¶ï¸   Store   â–¶ï¸   View
  (Flux)         (Flux)         (Flux)     (React)
  # å¦‚æœæˆ‘ä»¬å°è£…ä¸€ä¸‹,å°†actionå’Œdispatcheréšè—åœ¨æ¡†æ¶å†…éƒ¨
  Store   â–¶ï¸   View
  (Flux)  â—€ï¸  (React)
  # å¦‚æœå†è¿›ä¸€æ­¥å°è£…,å°†æ‰‹åŠ¨é€šçŸ¥æœºåˆ¶å†ä¼˜åŒ–
  Store   ğŸ”„   View
  (Flux)     (React)
```

##### åº”ç”¨åœºæ™¯æœ‰ä»€ä¹ˆåŒºåˆ«?
å•å‘çš„ä¼˜ç‚¹:
  - æ•°æ®çŠ¶æ€ä¼šè¢«è®°å½•è·Ÿè¸ª, å¯è¿½æº¯æºå¤´
  - ç»„ä»¶çš„æ•°æ®åªæœ‰ä¸€ä¸ªå‡ºå£å…¥å£, æ›´å®¹æ˜“ç†è§£, ç»´æŠ¤æ€§é«˜
å•å‘çš„ç¼ºç‚¹:
  - ä»£ç é‡è¾ƒå¤§(å¤§é‡é‡å¤å¼çš„ä»£ç )
  - æ•°æ®æµè½¬è¿‡ç¨‹è¾ƒé•¿
  - å…¨å±€å”¯ä¸€storeç®¡ç†çŠ¶æ€,å¤„ç†å±€éƒ¨çŠ¶æ€è¾ƒå¤šçš„åœºæ™¯ä¼šæ¯”è¾ƒç¹ç

åŒå‘çš„ä¼˜ç‚¹ === å•å‘çš„ç¼ºç‚¹
åŒå‘çš„ç¼ºç‚¹ === å•å‘çš„ä¼˜ç‚¹
  - æ•°æ®æ¥æºä¸æ­¢ä¸€ä¸ª, å¾ˆå®¹æ˜“å°†æ•°æ®æµè½¬å¼„å¾—ç´Šä¹±
  - å¦‚æœå†ç¼ºä¹ä¸€äº›ç®¡åˆ¶æ‰‹æ®µ,ä¼šè¶Šæ¥è¶Šéš¾ä»¥ç»´æŠ¤debug
  - é’ˆå¯¹ä¸åŒçš„åœºæ™¯é€‰æ‹©ä¸åŒçš„æµå‘

## æ€è€ƒ: Vueæ˜¯å¦‚ä½•å®ç°æ•°æ®åŒå‘çš„?
    object.defineProperty + Observer + Dep + Watcher
    è®¢é˜…å‘å¸ƒ / è§‚å¯Ÿè€… é…åˆä½¿ç”¨;
#### Vueä¸­æ•°æ®åŠ«æŒã€è§‚å¯Ÿè€…ã€å‘å¸ƒè€…-è®¢é˜…è€…ä¹‹é—´çš„å…³ç³»
  å‚è€ƒ"è®¾è®¡æ¨¡å¼-è§‚å¯Ÿè€…vså‘å¸ƒè®¢é˜….md"
#### Vueå®ç°çš„åŸç†
[å‚è€ƒ](https://juejin.cn/post/6844904069291606030)

## æ€è€ƒ: æ¨¡æ¿å’Œæ•°æ®æ˜¯å¦‚ä½•æ¸²æŸ“æˆDOMçš„ ?

- new Vue() -> å®ä¾‹åŒ–
- init -> åˆå§‹åŒ–
- mount -> æŒ‚è½½
  - mountComponent() `æ ¸å¿ƒå‡½æ•°`
    - vm._render
    - vm._update
- compiler -> ç¼–è¯‘
  - runtime compiler
- render -> æ¸²æŸ“ -> åˆ°æœ€åéƒ½è¦ç»è¿‡render functionè¿›è¡Œæ¸²æŸ“
- vNode -> ç”ŸæˆnodeèŠ‚ç‚¹ -> é€šè¿‡createElementç”ŸæˆvNode
- patch -> å¯¹æ¯”
- Dom -> ç”ŸæˆçœŸå®çš„Domå…ƒç´ 

ç»„ä»¶åŒ–/åˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹çš„è¿‡ç¨‹:
  åˆ›å»ºèŠ‚ç‚¹(createElm/createComponent)
    â¬‡ï¸
  <!-- è¿™ä¸€æ­¥å¥½åƒæ²¡æœ‰å­˜åœ¨çš„å¿…è¦äº† -->
  patch(å¯¹æ¯”å·®å¼‚, ç›®çš„æ˜¯: ä¸ºäº†ç”ŸæˆvNode Tree)
    â¬‡ï¸
------------------------
| vm._init(åˆå§‹åŒ–: merge options)
|   â¬‡ï¸
| $mount(Ele/Component + æŒ‚è½½é’©å­)
|   â¬‡ï¸
| vm._render(ç”ŸæˆvNodeéƒ¨åˆ† -> è‡ªèº«èŠ‚ç‚¹/ç»‘å®šæ•°æ®/æŒ‡å®šçˆ¶å­å…³ç³»ç­‰)
|   â¬‡ï¸
| vm._update(æ¸²æŸ“vNode)
|   â¬‡ï¸
| vm.__patch__(å°†vNodeèŠ‚ç‚¹è½¬åŒ–æˆçœŸæ­£çš„DomèŠ‚ç‚¹)
------------------------
    â¬‡ï¸
åˆ°æ­¤: å®Œæˆäº†æ•´ä¸ªpatchçš„è¿‡ç¨‹; å·²ç»ç”Ÿæˆäº†èŠ‚ç‚¹/ç»„ä»¶çš„DOM
    â¬‡ï¸
è°ƒç”¨`insert(parentElm, vnode.elm, refElm)`å®ŒæˆDOMçš„æ’å…¥
