/**
* 发布订阅模式
* @handles 事件处理函数集合
* @on 订阅事件
* @emit 发布事件
* @off 删除事件
**/

// 发布订阅模式的核心: 注册+订阅+发布+队列

class Event {
  constructor() {
    this.handles = {};
  }

  // 订阅事件
  on (eventType, handle) {
    if (!this.handles.hasOwnProperty(eventType)) {
      this.handles[eventType] = [];
    }
    if (typeof handle == 'function') {
      this.handles[eventType].push(handle);
    } else {
      throw new Error('缺少回调函数');
    }
    return this;
  }

  // 发布事件
  emit (eventType, ...args) {
    if (this.handles.hasOwnProperty(eventType)) {
      this.handles[eventType].forEach((item, key, arr) => {
        item.apply(null, args);
      })
    } else {
      throw new Error(`"${eventType}"事件未注册`);
    }
    return this;
  }

  // 删除事件
  off (eventType, handle) {
    // 可以只解绑,不触发callback
    if (!this.handles.hasOwnProperty(eventType)) {
      throw new Error(`"${eventType}"事件未注册`);
    } else if (typeof handle != 'function') {
      throw new Error('缺少回调函数');
    } else {
      this.handles[eventType].forEach((item, key, arr) => {
        if (item == handle) {
          arr.splice(key, 1);
        }
      })
    }
    return this;
  }

  /**
   * return this为了实现链式操作, 可以 Event.on().emit().off()
   */
}


let callback = function () {
  console.log('111111111111');
}
let _event = new Event();
_event.on('completed', (...args) => {
  console.log(args.join(' '));
})
_event.on('completed', callback);
_event.emit('completed', '222222222222'); // 222222222222
_event.off('completed', callback); // 111111111111
_event.emit('completed', '333333333333'); // 333333333333
